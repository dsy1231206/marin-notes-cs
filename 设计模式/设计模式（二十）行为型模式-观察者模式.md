# 设计模式（二十）行为型模式-观察者模式

###### 观察者模式又称为发布/订阅模式，它定义了一种一对多依赖关系，让多个观察者对象同时监听某一个主题对象（观察者是对象多的一方，主题对象是单个的一方）。这个主题对象在状态变化时，会通知所有的观察者对象，使他们可以自动更新自己。

##### 结构

###### Subject抽象主题：抽象主题角色把所有观察者对象保存在一个集合里，每一个主题都可以有任意数量的观察者。

###### 具体主题角色：将有关状态存入具体观察者对象，在具体主题的内部状态发生改变时，给所有注册过的观察者发送通知。

###### Observer：抽象观察者，是观察者的抽象类，定义了一个更新接口。

###### 具体观察者：具体观察者，实现抽象类的更新接口，以便更新自身状态。

##### 案例

微信公众号的订阅服务就是观察者模式的案例

![image-20220627095343746](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220627095343746.png)

###### 核心就是使用一个集合保存所有的观察者角色，并在更新自身主题状态时，通知所有的观察者对象。



##### 缺点

观察者模式调用通知方法，是循环集合里的观察者对象，依次调用他们的通知方法。

如果观察者过多，效率比较低，最后一个观察者更新消息比较延时

如果被观察者有循环依赖的话，那么被观察者发送通知会使观察者循环调用



##### JDK案例

在Java中，通过java.util.Observale类（抽象主题角色）和java.util.Observer接口（观察者角色）定义了观察者模式，所以实现这两个接口就可以写观察者模式了。

![image-20220627100709951](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220627100709951.png)

Observale类有一个Vector类来保存所有的观察者对象。

![image-20220627100847318](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220627100847318.png)

通知时先将Vector转成一个数组，再倒序遍历观察者，调用他们的update()方法

主题内容更新时，会先调用setChanged()方法，将changed置为true，才会去调用更新方法

调用完成后，会再次调用clearChanged()，将changed置为false